### web爬虫的基本原理

​		Web 机器人是能够在无需人类干预的情况下自动进行一系列Web 事务处理的软件程序
​		很多机器人会从一个Web 站点逛到另一个Web 站点，获取内容，跟踪超链，并对它们找到的数据进行处理。根据这些机器人自动探查Web 站点的方式，人们为它们起了一些各具特色的名字，比如“爬虫”、“蜘蛛”、“蠕虫”以及“机器人”等

​		**Web 爬虫是一种机器人**，它们**会递归地对各种信息性Web 站点进行遍历**，获取第一个Web 页面，然后获取那个页面指向的所有Web 页面，然后是那些页面指向的所有Web 页面，依此类推。递归地追踪这些Web 链接的机器人会沿着HTML 超链创建的网络“爬行”，所以将其称为爬虫（crawler）或蜘蛛（spider）

###### web爬虫的基本原理之避免环路

​	环路造成的不利影响有:

1. 将时间消耗与无限获取相同的页面上了
2. 每次循环的访问也是访问, 要是爬虫与服务器的连接良好, 那么循环访问就犹如是DOS攻击了
3. 爬取大量重复页面被称为dups, 这时的爬虫程序会被重复的内容所充斥

###### web爬虫的基本原理之如何记录访问历史

​		 为了保证不陷入环路我们**必须得记录访问的历史**, 但是这个记录很是**麻烦**, 问题**在于两个方面**:

1. **链接的数目极为庞大**, 现如今的web页面数以百亿计, 每次要在这么庞大的链接库里面查询是否已经访问, 那得需要非常优秀的搜索算法, 否则匹配一次就直接gg了
2. **数据的体积庞大,** 我们简单算一下, 假设一个url平均是40字节, 那么仅仅100亿个url, 那么体积就是400gb!!!, 这么大的数据为了保证快速读取一般会加载到内存中, 这对服务器的配置消耗极大

为解决这些问题, 我们一般会用到以下一些有用的技术

1. 树和散列表
2. 有损的存在位图
3. 检查点(讲已访问的URL保存在硬盘)
4. 分类派遣机器人

### 客户端识别和cookie

###### 客户端识别的目的与手段

为什么要进行客户端识别, 以淘宝为例？

1. 个性化的问候
2. 有的放矢的推荐
3. 管理信息的存档
4. 记录会话

可以实现客户端识别的方式有很多, 比如:

1. 承载用户身份信息的 HTTP 首部
2. 客户端 IP 地址跟踪，通过用户的 IP 地址对其进行识别
3. 用户登录，用认证方式来识别用户(配置首部的Authorization)
4. 胖 URL，一种在 URL 中嵌入识别信息的技术
5. cookie

###### cookie

​		可以笼统地将cookie 分为两类： **会话cookie 和持久cookie**。会话cookie 是一种临时cookie，它记录了用户访问站点时的设置和偏好。**用户退出浏览器时，会话cookie 就被删除**了。**持久cookie 的生存时间更长一些；它们存储在硬盘上，浏览器退出，计算机重启时它们仍然存在**。通常会用持久cookie 维护某个用户会周期性访问的站点的配置文件或登录名。

​		会话cookie 和持久cookie 之间**唯一的区别就是它们的过期时间**。

​		用户首次访问Web 站点时，Web 服务器对用户一无所知Web 服务器希望这个用户会再次回来，所以想给这个用户“拍上”一个独有的cookie，这样以后它就可以识别出这个用户了**。cookie 中包含了一个由名字= 值（name=value）这样的信息构成的任意列表**，并通过Set-Cookie 或Set-Cookie2 HTTP 响应（扩展）首部将其贴到用户身上去。

​		浏览器会记住从服务器返回的**Set-Cookie 或Set-Cookie2** 首部中的cookie 内容，并将cookie 集存储在浏览器的cookie 数据库中

###### 服务器认证

​		**HTTP 提供了一个原生的质询/ 响应（challenge/response）框架**，简化了对用户的认证过程

​		Web 应用程序收到一条HTTP 请求报文时，服务器没有按照请求执行动作，而是以一个“认证质询”进行响应，要求用户提供一些保密信息来说明他是谁，从而对其进行质询。
用户再次发起请求时，要附上保密证书（用户名和密码）。如果证书不匹配，服务器可以再次质询客户端，或产生一条错误信息。如果证书匹配，就可以正常完成请求了。

服务器认证的步骤：

1. 提示用户输入用户名和密码
2. 用冒号将用户名和密码连接起来
3. Base64编码
4. 发送认证信息

###### 服务器基本认证的安全缺陷

​		**基本认证简单便捷，但并不安全**。只能用它来防止非恶意用户无意间进行的访问，或将其与SSL 这样的加密技术配合使用。

1. 基本认证会通过网络发送用户名和密码，这些用户名和密码都是以一种很容易解码的形式表示的。如果有动机的第三方用户有可能会去拦截基本认证发送的用户名和密码，就要通过SSL 加密信道发送所有的HTTP 事务，或者使用更安全的认证协议，比如摘要认证。
2. 即使密码是以更难解码的方式加密的，第三方用户仍然可以捕获被修改过的用户名和密码，并将修改过的用户名和密码一次一次地重放给原始服务器，以获得对服务器的访问权。没有什么措施可用来防止这些重放攻击。
3.  即使将基本认证用于一些不太重要的应用程序，比如公司内部网络的访问控制或个性化内容的访问，一些不良习惯也会让它变得很危险。很多用户由于受不了大量密码保护的服务，会在这些服务间使用相同的用户名和密码。比如说从免费的因特网邮件网站捕获明文形式的用户名和密码，然后会发现用同样的用户名和密码还可以访问重要的在线银行网站！
4. 假冒服务器进行欺骗, 以得到用户发送的账号和密码,并存储起来以供后期使用

###### 服务器的摘要认证

​		摘要认证遵循的箴言是“**绝不通过网络发送密码**”。

​		客户端不会发送密码，而是会发送一个“指纹”或密码的“摘要”，这是密码的不可逆扰码。**客户端和服务器都知道这个密码**，因此服务器可以验证所提供的摘要是否与密码相匹配

​		比如使用 md5 和 Des加密 算法

### HTTPS的基本概念

我们需要一种能够提供下列功能的HTTP 安全技术。

1. 服务器认证（客户端知道它们是在与真正的而不是伪造的服务器通话）。
2. 客户端认证（服务器知道它们是在与真正的而不是伪造的客户端通话）。
3. 完整性（客户端和服务器的数据不会被修改）
4. 加密（客户端和服务器的对话是私密的，无需担心被窃听）
5. 效率（一个运行的足够快的算法，以便低端的客户端和服务器使用）。
6. 普适性（基本上所有的客户端和服务器都支持这些协议）。
7. 管理的可扩展性（在任何地方的任何人都可以立即进行安全通信）。
8. 适应性（能够支持当前最知名的安全方法）
9. 在社会上的可行性（满足社会的政治文化需要）。

大部分困难的编码及解码工作都是在SSL 库中完成的，所以Web 客户端和服务器在使用安全HTTP 时无需过多地修改其协议处理逻辑

在了解加密原理前,我们来掌握几个关键的名字概念

* 密码

  对文本进行编码，使偷窥者无法识别的算法

* 密钥

  改变密码行为的数字化参数。

* 对称密钥加密系统

  编/ 解码使用相同密钥的算法。

* 不对称密钥加密系统

  编/ 解码使用不同密钥的算法。

* 公开密钥加密系统

  一种能够使数百万计算机便捷地发送机密报文的系统。

* 数字签名

  用来验证报文未被伪造或篡改的校验和

* 数字证书

  由一个可信的组织验证和签发的识别信息

###### HTTPS的基本概念之对称密钥加密技术

​		编/ 解码使用相同密钥的算法。对称密钥加密技术的缺点之一就是发送者和接收者在互相对话之前，**一定要有一个共享的保密密钥**。

​		在对称密钥加密技术中，发送端和接收端要共享相同的密钥k 才能进行通信。发送端用共享的密钥来加密报文，并将得到的密文发送给接收端。接收端收到密文，并对其应用解密函数和相同的共享密钥，恢复出原始的明文

​		可用密钥值的数量取决于密钥中的位数，以及可能的密钥中有多少是有效的。就对称密钥加密技术来说，通常所有的密钥值都是有效的。8 位的密钥只有256 个可能的密钥值， 40 位的密钥可以有2^40 个可能的密钥值（大约是一万亿个密钥），128 位的密钥可以产生大约340 000 000 000 000 000 000 000 000 000 000 000 000 个可能的密钥值。现在一般采用的都是128位的加密

###### HTTPS的基本概念之公开密钥加密技术

​		公开密钥加密技术没有为每对主机使用单独的加密/ 解密密钥，而是使用了两个非对称密钥：一个用来对主机报文编码，另一个用来对主机报文解码。编码密钥是众所周知的（这也是公开密钥加密这个名字的由来），但只有主机才知道私有的解密密钥

###### HTTPS的基本概念之数字签名

数字签名是附加在报文上的特殊加密校验码。使用数字签名有以下两个好处。

1. 签名可以证明是作者编写了这 条报文。**只有作者才会有最机密的私有密钥**， 因此，只有作者才能计算出这些校验和。校验和就像来自作者的个人“签名”一样。
2. **签名可以防止报文被篡**改。如果有恶意攻击者在报文传输过程中对其进行了修改，校验和就不再匹配了。由于校验和只有作者保密的私有密钥才能产生，所以攻击者无法为篡改了的报文伪造出正确的校验码。

​	**在发送已加密的HTTP 报文之前，客户端和服务器要进行一次SSL 握手，在这个握手过程中，它们要完成以下工作**：

* 交换协议版本号
* 选择一个两端都了解的密码；
* 对两端的身份进行认证；
* 生成临时的会话密钥，以便加密信道。

###### HTTPS的基本概念之数字证书

​		数字证书中还包含一组信息，所有这些信息都是由一个官方的“证书颁发机构”以数字方式签发的。基本的数字证书中通常包含一些纸质ID 中常见的内容，比如：

* 对象的名称（人、服务器、组织等）；

* 过期时间；

* 证书发布者（由谁为证书担保）

* 来自证书发布者的数字签名；

  

  ​	而且，数字证书通常还包括对象的公开密钥，以及对象和所用签名算法的描述性信息。任何人都可以创建一个数字证书，但并不是所有人都能够获得受人尊敬的签发权，从而为证书信息担保，并用其私有密钥签发证书

  ​	**通过HTTPS 建立了一个安全Web 事务之后**，现代的浏览器都**会自动获取所连接服务器的数字证书**。如果服务器没有证书，安全连接就会失败。服务器证书中包含很多字段，其中包括：

1. Web 站点的名称和主机名；
2. Web 站点的公开密钥；
3. 签名颁发机构的名称；
4. 来自签名颁发机构的签名。

​	